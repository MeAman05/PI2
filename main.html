<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>üöó –ê–≤—Ç–æ—Å–∞–ª–æ–Ω</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(135deg, #667eea, #764ba2);
      margin: 0;
      padding: 20px;
      color: #fff;
    }
    h1 { text-align: center; color: #fff; }
    .container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      color: black;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }
    section { margin-bottom: 30px; }
    input, button, select { padding: 8px; margin: 5px; font-size: 14px; }
    button { cursor: pointer; border-radius: 5px; border: none; color: white; }
    button.add-btn { background: #3498db; }
    button.add-btn:hover { background: #2980b9; }
    button.delete-btn { background: #e74c3c; font-size: 12px; padding: 4px 8px; margin-left: 5px; }
    button.delete-btn:hover { background: #c0392b; }
    button.edit-btn { background: #f39c12; font-size: 12px; padding: 4px 8px; margin-left: 5px; }
    button.edit-btn:hover { background: #d35400; }
    button.call-btn { background: #2ecc71; font-size: 12px; padding: 4px 8px; margin-left: 5px; }
    button.call-btn:hover { background: #27ae60; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; color: black; }
    table, th, td { border: 1px solid #ccc; }
    th, td { padding: 8px; text-align: left; }
    td select { width: 100px; }
    .success { color: green; }
    .error { color: red; }

    /* --- CSS –¥–ª—è –ø–µ—á–∞—Ç–∏ A4 –∞–ª—å–±–æ–º --- */
    @page {
      size: A4 landscape;
      margin: 12mm;
    }
    @media print {
      html, body {
        width: 297mm;
        height: 210mm;
        margin: 0;
        background: #fff !important;
        color: #000 !important;
      }
      .container {
        max-width: 277mm;
        margin: 0;
        padding: 12mm;
        background: #fff !important;
        color: #000 !important;
        box-shadow: none !important;
        border-radius: 0 !important;
      }
      table, th, td {
        border: 1px solid #000 !important;
        color: #000 !important;
      }
      th, td { padding: 6px !important; font-size: 12px !important; }
      button, input, select, #carImageModal { display: none !important; }
      tr, td, th { page-break-inside: avoid; }
    }
  </style>
</head>
<body>
  <h1>üöò –ê–≤—Ç–æ—Å–∞–ª–æ–Ω</h1>
  <div class="container">
    <section>
      <h2>–î–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ–º–æ–±–∏–ª—å</h2>
      <input id="brand" placeholder="–ú–∞—Ä–∫–∞" />
      <input id="model" placeholder="–ú–æ–¥–µ–ª—å" />
      <input id="year" type="number" placeholder="–ì–æ–¥" />
      <input id="mileage" type="number" placeholder="–ü—Ä–æ–±–µ–≥" />
      <select id="gearbox">
        <option value="">–ö–æ—Ä–æ–±–∫–∞</option>
        <option value="–ê–≤—Ç–æ–º–∞—Ç">–ê–≤—Ç–æ–º–∞—Ç</option>
        <option value="–ú–µ—Ö–∞–Ω–∏–∫–∞">–ú–µ—Ö–∞–Ω–∏–∫–∞</option>
        <option value="–†–æ–±–æ—Ç">–†–æ–±–æ—Ç</option>
        <option value="–í–∞—Ä–∏–∞—Ç–æ—Ä">–í–∞—Ä–∏–∞—Ç–æ—Ä</option>
      </select>
      <select id="trim">
        <option value="">–ö–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏—è</option>
        <option value="–°—Ä–µ–¥–Ω—è—è">–°—Ä–µ–¥–Ω—è—è</option>
        <option value="–ü–æ–ª–Ω–∞—è">–ü–æ–ª–Ω–∞—è</option>
      </select>
      <input id="engineVolume" type="number" placeholder="–û–±—ä—ë–º –¥–≤–∏–≥–∞—Ç–µ–ª—è (–ª)" step="0.1" />
      <input id="fuelConsumption" type="number" placeholder="–†–∞—Å—Ö–æ–¥ —Ç–æ–ø–ª–∏–≤–∞ (–ª/100–∫–º)" step="0.1" />
      <select id="fuelType">
        <option value="">–¢–∏–ø —Ç–æ–ø–ª–∏–≤–∞</option>
        <option value="–ë–µ–Ω–∑–∏–Ω">–ë–µ–Ω–∑–∏–Ω</option>
        <option value="–ì–∏–±—Ä–∏–¥">–ì–∏–±—Ä–∏–¥</option>
        <option value="–ì–∞–∑">–ì–∞–∑</option>
      </select>
      <input id="color" placeholder="–¶–≤–µ—Ç" />
      <input id="price" type="number" placeholder="–¶–µ–Ω–∞" />
      <button class="add-btn" onclick="addCar()">–î–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ</button>
    </section>

    <section>
      <h2>–î–æ–±–∞–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞</h2>
      <input id="clientName" placeholder="–ò–º—è –∫–ª–∏–µ–Ω—Ç–∞" />
      <input id="clientPhone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω" />
      <button class="add-btn" onclick="addClient()">–î–æ–±–∞–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞</button>
    </section>

    <section>
      <h2>–°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑</h2>
      <input id="clientId" type="number" placeholder="ID –∫–ª–∏–µ–Ω—Ç–∞" />
      <input id="carId" type="number" placeholder="ID –∞–≤—Ç–æ" />
      <button class="add-btn" onclick="createOrder()">–°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑</button>
    </section>

    <section>
      <h2>–û—Ç—á—ë—Ç –æ –ø—Ä–æ–¥–∞–∂–∞—Ö</h2>
      <button class="add-btn" onclick="generateReport()">–°–∫–∞—á–∞—Ç—å –æ—Ç—á—ë—Ç (JSON)</button>
      <div id="reportArea"></div>
    </section>

    <section>
      <h2>üöó –ê–≤—Ç–æ–º–æ–±–∏–ª–∏</h2>
      <table id="carsTable">
        <tr>
          <th>ID</th>
          <th>–ú–∞—Ä–∫–∞ –∏ –º–æ–¥–µ–ª—å</th>
          <th>–ì–æ–¥</th>
          <th>–ü—Ä–æ–±–µ–≥</th>
          <th>–ö–æ—Ä–æ–±–∫–∞</th>
          <th>–ö–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏—è</th>
          <th>–û–±—ä—ë–º</th>
          <th>–†–∞—Å—Ö–æ–¥</th>
          <th>–¢–æ–ø–ª–∏–≤–æ</th>
          <th>–¶–≤–µ—Ç</th>
          <th>–¶–µ–Ω–∞</th>
          <th>–°—Ç–∞—Ç—É—Å</th>
          <th>–î–µ–π—Å—Ç–≤–∏—è</th>
        </tr>
      </table>

      <h2>–ö–ª–∏–µ–Ω—Ç—ã</h2>
      <table id="clientsTable">
        <tr><th>ID</th><th>–ò–º—è</th><th>–¢–µ–ª–µ—Ñ–æ–Ω</th><th>–î–µ–π—Å—Ç–≤–∏—è</th></tr>
      </table>

      <h2>–ó–∞–∫–∞–∑—ã</h2>
      <table id="ordersTable">
        <tr><th>ID</th><th>–ö–ª–∏–µ–Ω—Ç</th><th>–ê–≤—Ç–æ</th><th>–î–∞—Ç–∞</th><th>–°—É–º–º–∞</th><th>–î–µ–π—Å—Ç–≤–∏—è</th></tr>
      </table>
    </section>
  </div>

  <script>
    let cars = JSON.parse(localStorage.getItem("cars")) || [];
    let clients = JSON.parse(localStorage.getItem("clients")) || [];
    let orders = JSON.parse(localStorage.getItem("orders")) || [];

    function saveData() {
      localStorage.setItem("cars", JSON.stringify(cars));
      localStorage.setItem("clients", JSON.stringify(clients));
      localStorage.setItem("orders", JSON.stringify(orders));
    }

    function updateTables() {
      const carsTable = document.getElementById("carsTable");
      carsTable.innerHTML = `
        <tr>
          <th>ID</th><th>–ú–∞—Ä–∫–∞ –∏ –º–æ–¥–µ–ª—å</th><th>–ì–æ–¥</th><th>–ü—Ä–æ–±–µ–≥</th>
          <th>–ö–æ—Ä–æ–±–∫–∞</th><th>–ö–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏—è</th><th>–û–±—ä—ë–º</th><th>–†–∞—Å—Ö–æ–¥</th><th>–¢–æ–ø–ª–∏–≤–æ</th>
          <th>–¶–≤–µ—Ç</th><th>–¶–µ–Ω–∞</th><th>–°—Ç–∞—Ç—É—Å</th><th>–î–µ–π—Å—Ç–≤–∏—è</th>
        </tr>`;
      cars.forEach((car,i)=>{
        carsTable.innerHTML+=`
        <tr>
          <td>${i+1}</td>
          <td style="cursor:pointer;color:#2980b9;text-decoration:underline;" onclick="showGallery('${car.brand} ${car.model}')">
            ${car.brand} ${car.model}
          </td>
          <td>${car.year}</td>
          <td>${car.mileage||'-'}</td>
          <td>${car.gearbox||'-'}</td>
          <td>${car.trim||'-'}</td>
          <td>${car.engineVolume || '-'}</td>
          <td>${car.fuelConsumption || '-'}</td>
          <td>${car.fuelType || '-'}</td>
          <td>${car.color||'-'}</td>
          <td>${car.price} $ / ${car.price*84} —Å–æ–º</td>
          <td>
            <select onchange="changeCarStatus(${i}, this.value)">
              <option value="true" ${car.available?"selected":""}>–í –Ω–∞–ª–∏—á–∏–∏</option>
              <option value="false" ${!car.available?"selected":""}>–ü—Ä–æ–¥–∞–Ω</option>
            </select>
          </td>
          <td>
            <button class="delete-btn" onclick="deleteCar(${i})">–£–¥–∞–ª–∏—Ç—å</button>
            <button class="edit-btn" onclick="editCar(${i})">–ò–∑–º–µ–Ω–∏—Ç—å</button>
          </td>
        </tr>`;
      });

      const clientsTable = document.getElementById("clientsTable");
      clientsTable.innerHTML = `<tr><th>ID</th><th>–ò–º—è</th><th>–¢–µ–ª–µ—Ñ–æ–Ω</th><th>–î–µ–π—Å—Ç–≤–∏—è</th></tr>`;
      clients.forEach((c,i)=>{
        clientsTable.innerHTML+=`
        <tr>
          <td>${i+1}</td>
          <td>${c.name}</td>
          <td>${c.phone}</td>
          <td>
            <button class="delete-btn" onclick="deleteClient(${i})">–£–¥–∞–ª–∏—Ç—å</button>
            <button class="edit-btn" onclick="editClient(${i})">–ò–∑–º–µ–Ω–∏—Ç—å</button>
            <button class="call-btn" onclick="callClient(${i})">–ü–æ–∑–≤–æ–Ω–∏—Ç—å</button>
          </td>
        </tr>`;
      });

      const ordersTable = document.getElementById("ordersTable");
      ordersTable.innerHTML = `<tr><th>ID</th><th>–ö–ª–∏–µ–Ω—Ç</th><th>–ê–≤—Ç–æ</th><th>–î–∞—Ç–∞</th><th>–°—É–º–º–∞</th><th>–î–µ–π—Å—Ç–≤–∏—è</th></tr>`;
      orders.forEach((o,i)=>{
        ordersTable.innerHTML+=`
        <tr>
          <td>${i+1}</td>
          <td>${clients[o.clientId]?.name||'–ù–µ –Ω–∞–π–¥–µ–Ω'}</td>
          <td>${cars[o.carId]?.brand || ''} ${cars[o.carId]?.model || ''}</td>
          <td>${new Date(o.date).toLocaleDateString()}</td>
          <td>${o.sum} $ / ${o.sum*84} —Å–æ–º</td>
          <td>
            <button class="delete-btn" onclick="deleteOrder(${i})">–£–¥–∞–ª–∏—Ç—å</button>
          </td>
        </tr>`;
      });
    }

    function addCar() {
      const brand = document.getElementById("brand").value.trim();
      const model = document.getElementById("model").value.trim();
      const year = +document.getElementById("year").value;
      const mileage = +document.getElementById("mileage").value;
      const gearbox = document.getElementById("gearbox").value;
      const trim = document.getElementById("trim").value;
      const engineVolume = parseFloat(document.getElementById("engineVolume").value);
      const fuelConsumption = parseFloat(document.getElementById("fuelConsumption").value);
      const fuelType = document.getElementById("fuelType").value;
      const color = document.getElementById("color").value.trim();
      const price = +document.getElementById("price").value;

      if (!brand || !model || !year || !price) {
        alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è: –º–∞—Ä–∫–∞, –º–æ–¥–µ–ª—å, –≥–æ–¥, —Ü–µ–Ω–∞");
        return;
      }

      cars.push({
        brand, model, year, mileage, gearbox, trim,
        engineVolume, fuelConsumption, fuelType, color, price, available:true
      });
      saveData();
      updateTables();

      document.querySelectorAll("#brand, #model, #year, #mileage, #gearbox, #trim, #engineVolume, #fuelConsumption, #fuelType, #color, #price").forEach(input => input.value = "");
    }

    function addClient() {
      const name = document.getElementById("clientName").value.trim();
      const phone = document.getElementById("clientPhone").value.trim();
      if(!name || !phone) {
        alert("–í–≤–µ–¥–∏—Ç–µ –∏–º—è –∏ —Ç–µ–ª–µ—Ñ–æ–Ω –∫–ª–∏–µ–Ω—Ç–∞");
        return;
      }
      clients.push({name, phone});
      saveData();
      updateTables();
      document.getElementById("clientName").value = "";
      document.getElementById("clientPhone").value = "";
    }

    function createOrder() {
      const clientId = +document.getElementById("clientId").value - 1;
      const carId = +document.getElementById("carId").value - 1;
      if(clientId < 0 || clientId >= clients.length || carId < 0 || carId >= cars.length) {
        alert("–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π ID –∫–ª–∏–µ–Ω—Ç–∞ –∏–ª–∏ –∞–≤—Ç–æ");
        return;
      }
      if(!cars[carId].available) {
        alert("–ê–≤—Ç–æ–º–æ–±–∏–ª—å —É–∂–µ –ø—Ä–æ–¥–∞–Ω");
        return;
      }
      const sum = cars[carId].price;
      orders.push({clientId, carId, date: new Date().toISOString(), sum});
      cars[carId].available = false;
      saveData();
      updateTables();
      document.getElementById("clientId").value = "";
      document.getElementById("carId").value = "";
    }

    function deleteCar(i) { if(confirm("–£–¥–∞–ª–∏—Ç—å –∞–≤—Ç–æ–º–æ–±–∏–ª—å?")) { cars.splice(i,1); saveData(); updateTables(); } }
    function deleteClient(i) { if(confirm("–£–¥–∞–ª–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞?")) { clients.splice(i,1); saveData(); updateTables(); } }
    function deleteOrder(i) { if(confirm("–£–¥–∞–ª–∏—Ç—å –∑–∞–∫–∞–∑?")) { orders.splice(i,1); saveData(); updateTables(); } }
    function changeCarStatus(i, val) { cars[i].available = (val === "true"); saveData(); updateTables(); }

    function editCar(i) {  const car = cars[i]; const brand = prompt("–ú–∞—Ä–∫–∞", car.brand); if(brand===null)return; const model=prompt("–ú–æ–¥–µ–ª—å",car.model); if(model===null)return; const year=prompt("–ì–æ–¥",car.year); if(year===null)return; const mileage=prompt("–ü—Ä–æ–±–µ–≥",car.mileage); if(mileage===null)return; const gearbox=prompt("–ö–æ—Ä–æ–±–∫–∞",car.gearbox); if(gearbox===null)return; const trim=prompt("–ö–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏—è",car.trim); if(trim===null)return; const engineVolume=prompt("–û–±—ä—ë–º –¥–≤–∏–≥–∞—Ç–µ–ª—è",car.engineVolume); if(engineVolume===null)return; const fuelConsumption=prompt("–†–∞—Å—Ö–æ–¥ —Ç–æ–ø–ª–∏–≤–∞",car.fuelConsumption); if(fuelConsumption===null)return; const fuelType=prompt("–¢–∏–ø —Ç–æ–ø–ª–∏–≤–∞",car.fuelType); if(fuelType===null)return; const color=prompt("–¶–≤–µ—Ç",car.color); if(color===null)return; const price=prompt("–¶–µ–Ω–∞",car.price); if(price===null)return; cars[i]={brand,model,year:+year,mileage:+mileage,gearbox,trim,engineVolume:parseFloat(engineVolume),fuelConsumption:parseFloat(fuelConsumption),fuelType,color,price:+price,available:car.available}; saveData(); updateTables(); }

    function editClient(i) { const client=clients[i]; const name=prompt("–ò–º—è –∫–ª–∏–µ–Ω—Ç–∞",client.name); if(name===null)return; const phone=prompt("–¢–µ–ª–µ—Ñ–æ–Ω",client.phone); if(phone===null)return; clients[i]={name,phone}; saveData(); updateTables(); }

    function callClient(i) { alert("–ó–≤–æ–Ω–æ–∫ –∫–ª–∏–µ–Ω—Ç—É: "+clients[i].name+" –¢–µ–ª–µ—Ñ–æ–Ω: "+clients[i].phone); }
    function generateReport() { const data={cars,clients,orders}; const blob=new Blob([JSON.stringify(data,null,2)],{type:"application/json"}); const url=URL.createObjectURL(blob); const a=document.createElement("a"); a.href=url; a.download="report.json"; a.click(); URL.revokeObjectURL(url); }

    updateTables();

    const carPhotos = {
      "Toyota Corolla": "https://upload.wikimedia.org/wikipedia/commons/thumb/3/3f/2019_Toyota_Corolla_SE_Hybrid_1.8_Front.jpg/640px-2019_Toyota_Corolla_SE_Hybrid_1.8_Front.jpg",
      "Honda Civic": "https://upload.wikimedia.org/wikipedia/commons/thumb/f/f1/2022_Honda_Civic_EXL_1.5_Front.jpg/640px-2022_Honda_Civic_EXL_1.5_Front.jpg",
      "Nissan Qashqai": "https://upload.wikimedia.org/wikipedia/commons/thumb/e/e9/Nissan_Qashqai_Acenta_DCi_1.5_Front.jpg/640px-Nissan_Qashqai_Acenta_DCi_1.5_Front.jpg"
    };

    function showGallery(key) {
      const src = carPhotos[key];
      if(src) {
        const modal = document.getElementById("carImageModal");
        const img = document.getElementById("carImage");
        img.src = src;
        modal.style.display = "flex";
      } else {
        alert("–§–æ—Ç–æ –¥–ª—è —ç—Ç–æ–≥–æ –∞–≤—Ç–æ–º–æ–±–∏–ª—è –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.");
      }
    }

    document.addEventListener("DOMContentLoaded", () => {
      const modal = document.getElementById("carImageModal");
      modal.addEventListener("click", e => {
        if(e.target === modal) modal.style.display = "none";
      });
    });
  </script>

  <div id="carImageModal" style="
    display:none;
    position: fixed;
    top:0; left:0;
    width:100vw; height:100vh;
    background: rgba(0,0,0,0.8);
    justify-content: center;
    align-items: center;
    z-index: 10000;">
    <img id="carImage" src="" alt="–§–æ—Ç–æ –∞–≤—Ç–æ" style="max-width:90%; max-height:90%; border-radius:10px; box-shadow: 0 0 15px #fff;" />
  </div>

</body>
</html>
